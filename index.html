<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>MiiN Color Log v2 â€” swatchä¿å­˜ãƒ»JSONå…¥å‡ºåŠ›å¯¾å¿œ</title>

<style>
  :root{
    --bg:#0e0f13;
    --panel:#151720;
    --ink:#e9ecf3;
    --mut:#aeb6c7;
    --line:rgba(255,255,255,.1);
    --accent:#ff86b2;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:var(--bg);
    color:var(--ink);
    font-family:-apple-system,BlinkMacSystemFont,"Hiragino Kaku Gothic ProN","Noto Sans JP","Segoe UI",Roboto,Arial,sans-serif;
    line-height:1.6;
  }
  header{
    position:sticky;top:0;
    padding:14px 16px;
    background:linear-gradient(180deg,rgba(21,23,32,.9),rgba(21,23,32,.7));
    backdrop-filter:blur(8px);
    border-bottom:1px solid var(--line);
    z-index:5;
  }
  h1{margin:0;font-size:18px}
  main{max-width:980px;margin:0 auto;padding:16px;display:grid;gap:14px}
  .card{background:#111523;border:1px solid var(--line);border-radius:14px;padding:14px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  input[type="color"]{width:56px;height:40px;border:none;background:transparent}
  input[type="text"],input[type="datetime-local"]{
    background:#0f141f;
    border:1px solid rgba(255,255,255,.12);
    border-radius:10px;
    padding:10px 12px;
    color:#e9ecf3;
  }
  button{
    background:#3b82f6;
    border:none;
    color:#fff;
    padding:10px 14px;
    border-radius:10px;
    font-weight:700;
  }
  button.ghost{
    background:#1a2133;
    border:1px solid rgba(255,255,255,.16);
    color:#e9ecf3;
  }
  table{width:100%;border-collapse:collapse}
  th,td{border-bottom:1px solid rgba(255,255,255,.08);padding:8px 6px;font-size:14px;vertical-align:middle}
  .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#0f1526;border:1px solid rgba(255,255,255,.12);font-size:12px}
  .small{font-size:12px;color:var(--mut)}
  .ok{color:#19e28a;font-weight:700}
  .ng{color:#ff9aa5;font-weight:700}
  img.sw{width:38px;height:38px;border-radius:8px;border:1px solid rgba(255,255,255,.2);object-fit:cover;background:#000}
  .grid{display:grid;gap:10px;grid-template-columns:1fr}
  @media(min-width:760px){.grid{grid-template-columns:1fr 1fr}}

  /* Toast */
  .toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #19e28a;
    color: #000;
    padding: 10px 20px;
    border-radius: 8px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }
  .toast.show {
    opacity: 1;
    pointer-events: auto;
  }

  /* Dock */
  .dock {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: rgba(21,23,32,0.9);
    backdrop-filter: blur(8px);
    display: flex;
    justify-content: center;
    gap: 10px;
    padding: 10px;
    border-top: 1px solid var(--line);
  }
</style>
</head>

<body>
<header><h1>ğŸ¨ MiiN Color Log v2ï¼ˆEdge/Chromeæƒ³å®šãƒ»ã‚¹ã‚¦ã‚©ãƒƒãƒä¿å­˜ï¼‰</h1></header>

<section id="guide" class="card" style="margin:14px 12px;">
  <h2 style="font-size:16px;color:#e9ecf3;margin-top:0;">ğŸ“± ã‚¹ãƒãƒ›ã§ã®æ“ä½œã‚¬ã‚¤ãƒ‰</h2>
  <ul style="line-height:1.6;font-size:14px;color:#aeb6c7;padding-left:20px;">
    <li>ğŸ¨ è‰²ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã‚’é–‹ã</li>
    <li>ğŸ“ ã€Œèª°ã®è‰²ã€ã€Œå ´æ‰€ã€ã€Œãƒãƒ¼ãƒ ã€ã‚’å…¥åŠ›ã—ã¦ <b>ãƒ­ã‚°ã«è¿½åŠ </b></li>
    <li>ğŸ’¾ ãƒ­ã‚°ã¯è‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã™ï¼ˆSafariã§ã¯æ™‚ã€…ãƒªãƒ­ãƒ¼ãƒ‰ç¢ºèªï¼‰</li>
    <li>â¬‡ï¸ JSON / CSV ãƒœã‚¿ãƒ³ã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å…±æœ‰ã‚‚å¯èƒ½</li>
    <li>ğŸ§­ ä¸‹ã®ãƒãƒ¼ã‹ã‚‰ç°¡å˜æ“ä½œã§ãã¾ã™ï¼ˆã‚¹ãƒãƒ›æœ€é©åŒ–æ¸ˆï¼‰</li>
  </ul>
</section>

<main>
  <div class="card"><div id="env" class="small"></div></div>

  <div class="card">
    <div class="row">
      <input id="color" type="color" value="#ff9fb3">
      <input id="hex" type="text" placeholder="#HEXï¼ˆä¾‹ #ff9fb3ï¼‰" value="#ff9fb3">
      <input id="pname" type="text" placeholder="ãƒã‚¨ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆä¾‹ï¼šsoft apricot vividï¼æŸ”æ˜ã®ã‚¢ãƒ—ãƒªã‚³ãƒƒãƒˆï¼‰" style="flex:1 1 260px">
    </div>
    <div class="row">
      <input id="who" type="text" placeholder="èª°ã®è‰²ï¼ˆNami/FISH/ãµãŸã‚Šï¼‰">
      <input id="place" type="text" placeholder="å ´æ‰€ï¼ˆä¾‹ï¼šèŒ¨æœ¨ï¼‰">
      <input id="dt" type="datetime-local">
      <button id="add">ãƒ­ã‚°ã«è¿½åŠ </button>
      <button id="exportCsv" class="ghost">CSV</button>
      <button id="exportJson" class="ghost">JSON</button>
      <label class="ghost" style="border-radius:10px;padding:10px 14px;border:1px solid rgba(255,255,255,.16);cursor:pointer">
        JSONèª­ã¿è¾¼ã¿<input id="importJson" type="file" accept="application/json" style="display:none">
      </label>
    </div>
  </div>

  <div class="card">
    <div class="row"><span class="pill">ãƒ­ã‚°ä¸€è¦§</span><span class="small" id="count"></span></div>
    <table id="tbl">
      <thead><tr><th>#</th><th>æ—¥æ™‚</th><th>èª°</th><th>å ´æ‰€</th><th>è‰²</th><th>ã‚µãƒ³ãƒ—ãƒ«</th><th>PNG</th><th>å‰Šé™¤</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</main>

<div class="dock">
  <button id="addLogBtn">ï¼‹ ãƒ­ã‚°è¿½åŠ </button>
  <button class="ghost" id="exportBtn">ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
</div>

<div id="toast" class="toast">âœ… ä¿å­˜ã—ã¾ã—ãŸï¼</div>

<script>
(function(){
  const KEY='miin_color_log_v2';
  const $=s=>document.querySelector(s);

  function makeSwatch(hex){
    const c=document.createElement('canvas');
    c.width=120; c.height=120;
    const x=c.getContext('2d');
    x.fillStyle=hex; x.fillRect(0,0,c.width,c.height);
    x.fillStyle='rgba(0,0,0,.35)'; x.fillRect(0,c.height-22,c.width,22);
    x.fillStyle='#fff';
    x.font='bold 14px -apple-system, BlinkMacSystemFont, "Hiragino Kaku Gothic ProN", sans-serif';
    x.fillText(hex.toUpperCase(),8,c.height-7);
    return c.toDataURL('image/png');
  }

  function load(){
    try{ const main=JSON.parse(localStorage.getItem(KEY)); if(Array.isArray(main)) return main; }catch(e){}
    try{ const bak=JSON.parse(localStorage.getItem(KEY+'_bak')); if(Array.isArray(bak)) return bak; }catch(e){}
    return [];
  }

  function save(arr){
    const json=JSON.stringify(arr);
    try{
      localStorage.setItem(KEY,json);
      localStorage.setItem(KEY+'_bak',json);
    }catch(e){ console.warn('ä¿å­˜ã‚¨ãƒ©ãƒ¼:',e); }
    showToast('ğŸ’¾ ä¿å­˜ï¼†ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†ï¼');
    render();
  }

  function render(){
    const arr=load();
    const tb=$("#tbl tbody"); tb.innerHTML='';
    arr.forEach((r,i)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td>${i+1}</td>
        <td>${r.dt||''}</td>
        <td>${r.who||''}</td>
        <td>${r.place||''}</td>
        <td><span class="pill" style="border-color:${r.hex}">${r.hex||''}</span><div class="small">${r.pname||''}</div></td>
        <td>${r.swatch?`<img class="sw" src="${r.swatch}" alt="swatch">`:''}</td>
        <td>${r.swatch?`<a href="${r.swatch}" download="miin_swatch_${i+1}.png">ä¿å­˜</a>`:''}</td>
        <td><button data-del="${i}" class="ghost">å‰Šé™¤</button></td>`;
      tb.appendChild(tr);
    });
    $("#count").textContent=`ï¼ˆ${arr.length}ä»¶ï¼‰`;
  }

  function add(rec){
    const arr=load();
    arr.push(rec);
    save(arr);
  }

  function del(i){
    const arr=load();
    arr.splice(i,1);
    save(arr);
  }

  function showToast(msg){
    const toast=document.getElementById('toast');
    toast.textContent=msg;
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'),1500);
  }

  $("#color").addEventListener('input',e=>$("#hex").value=e.target.value);
  $("#add").addEventListener('click',()=>{
    const hex=($("#hex").value||'').trim();
    const who=($("#who").value||'').trim();
    const place=($("#place").value||'').trim();
    const dt=($("#dt").value||'').trim() || new Date().toISOString().slice(0,16).replace('T',' ');
    const pname=($("#pname").value||'').trim();
    const swatch=makeSwatch(hex);
    add({hex,who,place,dt,pname,swatch});
  });

  $("#tbl").addEventListener('click',e=>{
    const btn=e.target.closest('button[data-del]');
    if(btn){ del(parseInt(btn.dataset.del,10)); }
  });

  $("#exportCsv").addEventListener('click',()=>{
    const arr=load();
    const head='datetime,who,place,hex,pname,swatch_dataurl\n';
    const body=arr.map(r=>[r.dt,r.who,r.place,r.hex,(r.pname||'').replace(/,/g,' '),r.swatch].join(',')).join('\n');
    const blob=new Blob([head+body],{type:'text/csv'});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download='miin_color_log_v2.csv';
    a.click();
    showToast('ğŸ’¾ CSVã‚’æ›¸ãå‡ºã—ã¾ã—ãŸï¼');
  });

  $("#exportJson").addEventListener('click',()=>{
    const arr=load();
    const blob=new Blob([JSON.stringify(arr,null,2)],{type:'application/json'});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download='miin_color_log_v2.json';
    a.click();
    showToast('ğŸ“¤ JSONã‚’æ›¸ãå‡ºã—ã¾ã—ãŸï¼');
  });

  $("#importJson").addEventListener('change',e=>{
    const f=e.target.files[0]; if(!f) return;
    const rd=new FileReader();
    rd.onload=()=>{
      try{
        const data=JSON.parse(rd.result);
        if(Array.isArray(data)){ save(data); showToast('âœ… JSONã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼'); }
      }catch(err){ alert('JSONã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚'); }
    };
    rd.readAsText(f);
  });

  $("#addLogBtn").addEventListener('click',()=>showToast('ğŸ¨ æ–°ã—ã„è‰²ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼'));
  $("#exportBtn").addEventListener('click',()=>showToast('ğŸ’¾ CSVã‚’æ›¸ãå‡ºã—ã¾ã—ãŸï¼'));

  const ua=navigator.userAgent;
  const isEdge=/Edg\//.test(ua);
  const isChrome=/Chrome\//.test(ua)&&!isEdge;
  const isSafari=/^((?!chrome|android).)*safari/i.test(ua);
  let note=`Browser: ${isEdge?'Edge':isChrome?'Chrome':isSafari?'Safari':'Other'} ï¼ Storage: `;
  let storageOK=true;
  try{ localStorage.setItem('__chk','1'); localStorage.removeItem('__chk'); }catch(e){ storageOK=false }
  note+=storageOK?'<span class="ok">OK</span>':'<span class="ng">NG</span>';
  $("#env").innerHTML=note+'ã€€<small class="small">ï¼ˆâ€»iOSã®ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€çµŒç”±ã§ã¯NGã®ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼‰</small>';

  render();
})();
</script>

</body>
</html>

