<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>MiiN Color Log v2 â€” swatchä¿å­˜ãƒ»JSONå…¥å‡ºåŠ›å¯¾å¿œ</title>
<style>
  :root{--bg:#0e0f13;--panel:#151720;--ink:#e9ecf3;--mut:#aeb6c7;--line:rgba(255,255,255,.1);--accent:#ff86b2}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,"Hiragino Kaku Gothic ProN","Noto Sans JP","Segoe UI",Roboto,Arial,sans-serif;line-height:1.6}
  header{position:sticky;top:0;padding:14px 16px;background:linear-gradient(180deg,rgba(21,23,32,.9),rgba(21,23,32,.7));backdrop-filter:blur(8px);border-bottom:1px solid var(--line);z-index:5}
  h1{margin:0;font-size:18px}
  main{max-width:980px;margin:0 auto;padding:16px;display:grid;gap:14px}
  .card{background:#111523;border:1px solid var(--line);border-radius:14px;padding:14px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  input[type="color"]{width:56px;height:40px;border:none;background:transparent}
  input[type="text"],input[type="datetime-local"]{background:#0f141f;border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:10px 12px;color:#e9ecf3}
  button{background:#3b82f6;border:none;color:#fff;padding:10px 14px;border-radius:10px;font-weight:700}
  button.ghost{background:#1a2133;border:1px solid rgba(255,255,255,.16);color:#e9ecf3}
  table{width:100%;border-collapse:collapse}
  th,td{border-bottom:1px solid rgba(255,255,255,.08);padding:8px 6px;font-size:14px;vertical-align:middle}
  .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#0f1526;border:1px solid rgba(255,255,255,.12);font-size:12px}
  .small{font-size:12px;color:var(--mut)}
  .ok{color:#19e28a;font-weight:700}
  .ng{color:#ff9aa5;font-weight:700}
  img.sw{width:38px;height:38px;border-radius:8px;border:1px solid rgba(255,255,255,.2);object-fit:cover;background:#000}
  .grid{display:grid;gap:10px;grid-template-columns:1fr}
  @media(min-width:760px){.grid{grid-template-columns:1fr 1fr}}
</style>
</head>
<body>
<header><h1>ğŸ¨ MiiN Color Log v2ï¼ˆEdge/Chromeæƒ³å®šãƒ»ã‚¹ã‚¦ã‚©ãƒƒãƒä¿å­˜ï¼‰</h1></header>
<main>
  <div class="card">
    <div id="env" class="small"></div>
  </div>

  <div class="card">
    <div class="row">
      <input id="color" type="color" value="#ff9fb3">
      <input id="hex" type="text" placeholder="#HEXï¼ˆä¾‹ #ff9fb3ï¼‰" value="#ff9fb3">
      <input id="pname" type="text" placeholder="ãƒã‚¨ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆä¾‹ï¼šsoft apricot vividï¼æŸ”æ˜ã®ã‚¢ãƒ—ãƒªã‚³ãƒƒãƒˆï¼‰" style="flex:1 1 260px">
    </div>
    <div class="row">
      <input id="who" type="text" placeholder="èª°ã®è‰²ï¼ˆNami/FISH/ãµãŸã‚Šï¼‰">
      <input id="place" type="text" placeholder="å ´æ‰€ï¼ˆä¾‹ï¼šèŒ¨æœ¨ï¼‰">
      <input id="dt" type="datetime-local">
      <button id="add">ãƒ­ã‚°ã«è¿½åŠ </button>
      <button id="exportCsv" class="ghost">CSV</button>
      <button id="exportJson" class="ghost">JSON</button>
      <label class="ghost" style="border-radius:10px;padding:10px 14px;border:1px solid rgba(255,255,255,.16);cursor:pointer">
        JSONèª­ã¿è¾¼ã¿<input id="importJson" type="file" accept="application/json" style="display:none">
      </label>
    </div>
  </div>

  <div class="card">
    <div class="row"><span class="pill">ãƒ­ã‚°ä¸€è¦§</span><span class="small" id="count"></span></div>
    <table id="tbl">
      <thead><tr><th>#</th><th>æ—¥æ™‚</th><th>èª°</th><th>å ´æ‰€</th><th>è‰²</th><th>ã‚µãƒ³ãƒ—ãƒ«</th><th>PNG</th><th>å‰Šé™¤</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</main>

<script>
(function(){
  const KEY='miin_color_log_v2';
  const $=s=>document.querySelector(s);
  function makeSwatch(hex){
    const c=document.createElement('canvas');
    c.width=120; c.height=120;
    const x=c.getContext('2d');
    x.fillStyle=hex; x.fillRect(0,0,c.width,c.height);
    x.fillStyle='rgba(0,0,0,.35)'; x.fillRect(0,c.height-22,c.width,22);
    x.fillStyle='#fff';
    x.font='bold 14px -apple-system, BlinkMacSystemFont, "Hiragino Kaku Gothic ProN", sans-serif';
    x.fillText(hex.toUpperCase(),8,c.height-7);
    return c.toDataURL('image/png');
  }
  function load(){ try{return JSON.parse(localStorage.getItem(KEY)||'[]')}catch(e){return []} }
  function save(arr){ localStorage.setItem(KEY, JSON.stringify(arr)); render(); }
  function add(rec){ const arr = load(); arr.push(rec); save(arr); }
  function del(idx){ const arr = load(); arr.splice(idx,1); save(arr); }

  function render(){
    const arr = load();
    const tb = $("#tbl tbody"); tb.innerHTML='';
    arr.forEach((r,i)=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${i+1}</td>
        <td>${r.dt||''}</td>
        <td>${r.who||''}</td>
        <td>${r.place||''}</td>
        <td><span class="pill" style="border-color:${r.hex}">${r.hex||''}</span><div class="small">${r.pname||''}</div></td>
        <td>${r.swatch?`<img class="sw" src="${r.swatch}" alt="swatch">`:''}</td>
        <td>${r.swatch?`<a href="${r.swatch}" download="miin_swatch_${i+1}.png">ä¿å­˜</a>`:''}</td>
        <td><button data-del="${i}" class="ghost">å‰Šé™¤</button></td>
      `;
      tb.appendChild(tr);
    });
    $("#count").textContent = `ï¼ˆ${arr.length}ä»¶ï¼‰`;
  }

  const ua = navigator.userAgent;
  const isEdge = /Edg\//.test(ua);
  const isChrome = /Chrome\//.test(ua) && !isEdge;
  const isSafari = /^((?!chrome|android).)*safari/i.test(ua);
  let note = `Browser: ${isEdge?'Edge':isChrome?'Chrome':isSafari?'Safari':'Other'} ï¼ Storage: `;
  let storageOK = true;
  try{ localStorage.setItem('__chk','1'); localStorage.removeItem('__chk'); }
  catch(e){ storageOK = false }
  note += storageOK ? '<span class="ok">OK</span>' : '<span class="ng">NG</span>';
  $("#env").innerHTML = note + 'ã€€<small class="small">ï¼ˆâ€»iOSã®ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€çµŒç”±ã§ã¯NGã®ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼‰</small>';

  $("#color").addEventListener('input',e=>$("#hex").value=e.target.value);
  $("#add").addEventListener('click', ()=>{
    const hex = ($("#hex").value||'').trim();
    const who = ($("#who").value||'').trim();
    const place = ($("#place").value||'').trim();
    const dt = ($("#dt").value||'').trim() || new Date().toISOString().slice(0,16).replace('T',' ');
    const pname = ($("#pname").value||'').trim();
    const swatch = makeSwatch(hex);
    add({hex, who, place, dt, pname, swatch});
    alert('ä¿å­˜ã—ã¾ã—ãŸï¼ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰');
  });
  $("#tbl").addEventListener('click', (e)=>{
    const btn = e.target.closest('button[data-del]');
    if(btn){ del(parseInt(btn.dataset.del,10)); }
  });
  $("#exportCsv").addEventListener('click', ()=>{
    const arr = load();
    const head = 'datetime,who,place,hex,pname,swatch_dataurl\n';
    const body = arr.map(r=>[r.dt,r.who,r.place,r.hex,(r.pname||'').replace(/,/g,' '),r.swatch].join(',')).join('\n');
    const blob = new Blob([head+body], {type:'text/csv'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download='miin_color_log_v2.csv'; a.click();
  });
  $("#exportJson").addEventListener('click', ()=>{
    const arr = load();
    const blob = new Blob([JSON.stringify(arr,null,2)], {type:'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download='miin_color_log_v2.json'; a.click();
  });
  $("#importJson").addEventListener('change', (e)=>{
    const f = e.target.files[0]; if(!f) return;
    const rd = new FileReader();
    rd.onload = ()=>{
      try{ const data = JSON.parse(rd.result); if(Array.isArray(data)){ save(data); alert('JSONã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼'); } }
      catch(err){ alert('JSONã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚'); }
    };
    rd.readAsText(f);
  });

  render();
})();
</script>
</body>
</html>
